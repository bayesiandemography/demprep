---
title: "Converting Dates to Periods, Cohorts, Age Groups, and Lexis Triangles"
output: rmarkdown::html_vignette
vignette: >
    %\VignetteIndexEntry{Converting Dates to Periods, Cohorts, Age Groups, and Lexis Triangles}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library(knitr)
library(demprep)
opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE,
  fig.width = 6.5,
  fig.align = "center"
)
deaths <- data.frame(person = c("Anwar", "Baptiste", "Candice"),
                     dob = c("2014-02-14", "2012-01-04", "2019-04-29"),
                     date = c("2019-10-11", "2020-02-27", "2020-08-01"))

births_in <- data.frame(date = c("2020-05-18", "2020-07-02", "2020-10-05"),
                     dob = c("2000-02-14", "2002-05-18", "1990-12-18"))

births_out <- data.frame(date = c("2020-03-14", "2020-08-22"),
                         dob = c("1968-01-23", "2008-03-05"))
```

# Introduction

Most demographic datasets, including datasets used in the **dem** packages, divide events into groups defined by combinations of categories based on characteristics such as age, sex, region, and time. The cross-tabulation below, for example, classifes deaths by age group and period:
```{r deaths-array, echo = FALSE}
deaths_array <- matrix(c(98, 25, 11, 89, 29, 12, 93, 32, 16),
                       nrow = 3, 
                       ncol = 3,
                       dimnames = list(age = paste("Age", c("0", "1-4", "5-9")),
                                       year = c("2000-2005", "2005-2010", "2010-2015")))
kable(deaths_array,
      align = "c")
```
The raw individual-level that these sorts of tables ultimately derive from typically refer to dates, rather than periods or age groups. The data below, for example refers to date of birth and date of death:
```{r deaths-list, echo = FALSE}
deaths_list <- data.frame(name = c("Aadya",
                                  "Diya", 
                                  "Saanvi", 
                                  "Amaira"),
                          date_of_birth = c("1965-11-07", 
                                            "1958-01-26", 
                                            "2007-02-06", 
                                            "1935-07-18"), 
                          date_of_death = c("2020-02-01",
                                            "2020-04-03", 
                                            "2020-06-02", 
                                            "2020-10-06"))
kable(deaths_list)
```

Converting dates into periods and age groups is not always easy. Consider, for instance, the problem of measuring a person's age in months. If a person is born on 31 January 2001, on what date does that person become one month old? On 28 February 2001, 1 March 2001, or some other date? According to base *R*, the answer is 3 March 2001:
```{r one-month}
seq.Date(from = as.Date("2001-01-31"), 
         by = "month",
         length.out = 2)
```

Package **demprep** contains a suite of functions for converting dates to age groups, periods, and other age-time categories needed by the **dem** packages. To help resolve cases where the answers are not obvious, such as when deciding when a person turns one month old, **demprep** uses some basic rules that try to reflect common practices in applied demography.


# Lexis diagrams and age-time plans

```{r agetime, echo = FALSE}
date <- as.Date(c("2020-12-07", "2022-05-30"))
dob <- as.Date(c("2001-07-22", "2006-03-14"))
age <- c(19 + 4.5/12, 16 + 2.5/12)
```

When reasoning about age and time, demographers often make use of Lexis diagrams. The figure below is an example of a Lexis diagram. The horizontal axis measures calendar time, and the vertical axis measures age. The black diagonal line with an *A* at the end is the "life line" for a person who is born on `r strftime(dob[1], "%e %B %Y")` and who dies on `r strftime(date[1], "%e %B %Y")`. Similarly, the line with the *B* at the end the life line for a person who is born on `r strftime(dob[2], "%e %B %Y")` and dies on `r strftime(date[2], "%e %B %Y")`. A life line in a traditional Lexis diagram always covers the same distance along the vertical axis as it does along the horizontal axis, because a person always gains one year of age for each year of calendar time.

```{r lexis1, echo = FALSE, fig.width = 5, fig.height = 5}
breaks_time <- seq.Date(from = as.Date("2000-01-01"), 
                        to = as.Date("2025-01-01"), 
                        by = "5 years")
breaks_age <- seq.int(from = 0, 
                      to = 25, 
                      by = 5)
labels_time <- make_labels_period(breaks_time)
labels_age <- make_labels_age(breaks = breaks_age,
                              open_last = FALSE)

demprep:::plot_date_to_age_triangle(date = date,
                                    dob = dob,
                                    unit = "year",
                                    breaks_time = breaks_time,
                                    breaks_age = breaks_age,
                                    open_last = FALSE,
                                    labels_time = labels_time,
                                    labels_age = labels_age,
                                    show_vert = TRUE,
                                    show_diag = TRUE,
                                    show_months = FALSE)
text(x = date,
     y = age,
     labels = expression(italic(A), italic(B)),
     pos = 4)
```

The light blue grid in the Lexis diagram above depicts an "age-time plan" [references]. An age-time plan is a set of rules for how exact times and ages (i.e. points in the Lexis plane) are assigned to discrete age and time categories. The age-time plan above divides divides age into 5-year age groups, and divides time into 5-year periods, with each period starting on 1 January. Deaths *A* and *B* both belong to age group "15-19" and period "2020-2025".

Although age group and period are the most commonly-used age-time categories in demography, "cohorts" are also important to some applications. A cohort is a group of people who all experience a particular event during a given period. The event is normally birth, but it can be, for instance, marriage or joining an organization. The people who are born during the period 1950-1960, form a birth cohort, for example, and the people who marry during the year 2018 form a marriage cohort.

On a Lexis diagram, the birth cohort for a person or event can be inferred by following the relevant life line back to the horizontal axis and seeing which period the birth falls within. In the Lexis diagram above, for instance, death *A* belongs to the birth cohort "2000-2005" and death *B* belongs to the birth cohort "2005-2010".

When working with cohorts, it is often helpful to add one additional age-time category: the Lexis triangle. Lexis triangles are defined by diagonal, vertical, and horizontal lines in a Lexis diagram. Death *A* in the diagram above belongs to an upper Lexis triangle, and death *B* belongs to a lower Lexis triangle.

Knowing the age group and period of an event is not enough to fully determine the cohort for that event. If we did not have access to the Lexis diagram above, for instance, and all we knew about death *A* was that it belonged to age group "15-19" and period "2020-2025", then we would not be able to determine whether *A* belonged to the the cohort "2000-2005" or to the cohort "2005-2010". If, however, we also knew that *A* belonged to an upper Lexis triangle, then the ambiguity would be be removed: we could infer that *A* belonged to the cohort "2000-2005". Similarly, if we knew only that *B* belonged to age group "15-19", period "2020-2025", and a lower Lexis triangle, we would have enough information to conclude that *B* belongs to the cohort "2005-2010".

Open age group. (and first cohort)

Equal age-time lengths.



# Overview of date conversion functions

The date conversion functions in **demprep** are

| Periods | Cohorts | Age groups | Lexis triangles |
|:--------|:--------|:-----------|:----------------|
| `date_to_period_year` | `date_to_cohort_year` | `date_to_age_year` | `date_to_triangle_year` |
| `date_to_period_multi` | `date_to_cohort_multi` | `date_to_age_multi` | `date_to_triangle_multi` |
| `date_to_period_custom` | `date_to_cohort_custom` | `date_to_age_custom` | \<none\> |
| \<none\> | \<none\> | `date_to_age_lifetab`| \<none\> |
| \<none\> | \<none\> | `date_to_age_births` | `date_to_triangle_births` |
| `date_to_period_quarter` | `date_to_cohort_quarter` | `date_to_age_quarter` | `date_to_triangle_quarter` |
| `date_to_period_month` | `date_to_cohort_month` | `date_to_age_month` | `date_to_triangle_month` |

The functions have a common format: `date_to_<type>_<length>`. The choices for type are "period", "cohort", "age" (short for "age group"), and "triangle" (short for "Lexis triangle".) The choices for length are

- `year` All intervals have length equal to one year.
- `multi` All intervals have lengths of $n$ years, where $n$ is typically 5 or 10.
- `custom` Intervals are measured in whole years, but can have varying lengths.
- `lifetab` A specialised form of `custom` often used for defining age group in life tables.
- `births` A specialised form a `custom`, often used with births.
- `quarter` Three-month intervals. Periods and cohorts begin on 1 January, 1 April, 1 July, and 1 October.
- `month` One-month intervals.

- special case: 
- exception to equality: final age group, first cohort
- Lexis triangle only definied 

<!-- # Periods -->

<!-- ## General issues -->

<!-- - when to start -->
<!-- - varying lengths (months, quarter, leap years) -->
<!-- - ambiguity of labels -->

<!-- - birthday starts at first second of day (not at time when born) -->


<!-- ## Single-year periods -->



<!-- ```{r} -->
<!-- dth_per_yr <- deaths -->
<!-- dth_per_yr$time_jan <- date_to_period_year(date = dth_per_yr$date) -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_year(date = dth_per_yr$date) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_yr$time_jul <- date_to_period_year(date = dth_per_yr$date, -->
<!--                                              month_start = "Jul") -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_year(date = dth_per_yr$date, -->
<!--                          month_start = "Jul") -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_yr$time_jul_end <- date_to_period_year(date = dth_per_yr$date, -->
<!--                                                month_start = "Jul", -->
<!--                                                label_year_start = FALSE) -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_year(date = dth_per_yr$date, -->
<!--                          month_start = "Jul", -->
<!--                          label_year_start = FALSE) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- dth_per_yr$time_jan_end <- date_to_period_year(date = dth_per_yr$date, -->
<!--                                                month_start = "Jan", -->
<!--                                                label_year_start = FALSE) -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_year(date = dth_per_yr$date, -->
<!--                          month_start = "Jan", -->
<!--                          label_year_start = FALSE) -->
<!-- ``` -->


<!-- ## Multi-year periods, with equal lengths -->


<!-- ```{r} -->
<!-- dth_per_multi <- deaths -->
<!-- dth_per_multi$time_5 <- date_to_period_multi(date = dth_per_multi$date) -->
<!-- dth_per_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_multi(date = dth_per_multi$date) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_multi$time_5_jul <- date_to_period_multi(date = dth_per_multi$date, -->
<!--                                                  month_start = "Jul") -->
<!-- dth_per_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_multi(date = dth_per_multi$date, -->
<!--                           month_start = "Jul") -->
<!-- ``` -->



<!-- ```{r} -->
<!-- dth_per_multi$time_10 <- date_to_period_multi(date = dth_per_multi$date, -->
<!--                                               width = 10) -->
<!-- dth_per_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_multi(date = dth_per_multi$date, -->
<!--                           width = 10) -->
<!-- ``` -->





<!-- ```{r} -->
<!-- dth_per_multi$time_01 <- date_to_period_multi(date = dth_per_multi$date, -->
<!--                                                origin = 2001) -->
<!-- dth_per_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_multi(date = dth_per_multi$date, -->
<!--                           origin = 2001) -->
<!-- ``` -->


<!-- ## Multi-year periods, with varying lengths -->


<!-- ```{r} -->
<!-- dth_per_custom <- deaths -->
<!-- dth_per_custom$time <- date_to_period_custom(date = dth_per_custom$date, -->
<!--                                              breaks = c("2016-01-01", -->
<!--                                                         "2020-01-01", -->
<!--                                                         "2025-01-01")) -->
<!-- dth_per_custom -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_custom(date = dth_per_custom$date, -->
<!--                            breaks = c("2016-01-01", -->
<!--                                       "2020-01-01",  -->
<!--                                       "2025-01-01")) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_custom <- deaths -->
<!-- dth_per_custom$jan_1_5 <- date_to_period_custom(date = dth_per_custom$date, -->
<!--                                                 breaks = c("2019-01-01", -->
<!--                                                            "2020-01-01", -->
<!--                                                            "2025-01-01")) -->
<!-- dth_per_custom -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_custom(date = dth_per_custom$date, -->
<!--                           breaks = c("2019-01-01",  -->
<!--                                      "2020-01-01", -->
<!--                                      "2025-01-01")) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_custom <- deaths -->
<!-- dth_per_custom$time_jul <- date_to_period_custom(date = dth_per_custom$date, -->
<!--                                                  breaks = c("2019-07-01", -->
<!--                                                             "2020-07-01", -->
<!--                                                             "2025-07-01")) -->
<!-- dth_per_custom -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.5} -->
<!-- plot_date_to_period_custom(date = dth_per_custom$date, -->
<!--                            breaks = c("2019-07-01", -->
<!--                                       "2020-07-01",  -->
<!--                                       "2025-07-01")) -->
<!-- ``` -->



<!-- ## Quarter-length periods -->


<!-- ```{r} -->
<!-- dth_per_quarter <- deaths -->
<!-- dth_per_quarter$time <- date_to_period_quarter(dth_per_custom$date) -->
<!-- dth_per_quarter -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_quarter(dth_per_quarter$date) -->
<!-- ``` -->



<!-- ## Month-length periods -->

<!-- ```{r} -->
<!-- dth_per_month <- deaths -->
<!-- dth_per_month$time <- date_to_period_month(dth_per_custom$date) -->
<!-- dth_per_month -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_period_month(dth_per_month$date[1:2]) -->
<!-- ``` -->


<!-- # Cohorts -->

<!-- ## General issues -->

<!-- Defn of cohort -->

<!-- Same as period, but with open interval at start -->

<!-- Boundaries -->


<!-- ## Single-year cohorts -->

<!-- ```{r} -->
<!-- dth_per_yr <- deaths -->
<!-- dth_per_yr$time_closed <- date_to_cohort_year(date = dth_per_yr$date) -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_cohort_year(date = dth_per_yr$date) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dth_per_yr$time_open <- date_to_cohort_year(date = dth_per_yr$date, -->
<!--                                             open_first = TRUE) -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_cohort_year(date = dth_per_yr$date, -->
<!--                          open_first = TRUE) -->
<!-- ``` -->



<!-- ```{r} -->
<!-- dth_per_yr$time_min <- date_to_cohort_year(date = dth_per_yr$date, -->
<!--                                             break_min = "2020-01-01") -->
<!-- dth_per_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 1.75} -->
<!-- plot_date_to_cohort_year(date = dth_per_yr$date, -->
<!--                          break_min = "2020-01-01") -->
<!-- ``` -->

<!-- # Age groups -->

<!-- ## General issues -->

<!-- Abstract: $\text{age} = t_{\text{event}} - t_{\text{dob}}$ -->

<!-- Complications.  -->

<!-- - Child born on 31 October. On what day does child become 1 month old?  -->
<!-- - Child born on 30 November. On what day does child become 1 month old? -->
<!-- - Child born on 29 February 2000. On what day does child become 1 year old? [1 March 2001] -->

<!-- Principles: -->
<!-- - tick over when day of date equals day of dob. Includes leap years. -->

<!-- \begin{equation} -->
<!-- \begin{split} -->
<!-- \text{age in completed months} & = 12 \times (\text{year of event} - \text{year of birth}) \\ -->
<!-- & \quad + \text{month of event} - \text{month of birth} \\ -->
<!-- & \quad - \text{partial-month adjustment} -->
<!-- \end{split} -->
<!-- \end{equation} -->

<!-- Partial-month adjustment: if $\text{day of event} \ge \text{day of birth}$, then 0; otherwise 1. -->


<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- date <- as.Date(c("2021-03-30", "2021-03-10")) -->
<!-- dob <- as.Date(c("2021-01-30", "2021-01-10")) -->
<!-- plot_date_to_age_month(date = date, -->
<!--                        dob = dob, -->
<!--                        break_max = 2, -->
<!--                        show_months = TRUE) -->
<!-- ``` -->



<!-- \begin{equation} -->
<!-- \text{age in completed quarters} = \text{floor}(\text{age in completed months} / 3) -->
<!-- \end{equation} -->

<!-- \begin{equation} -->
<!-- \text{age in completed quarters} = \text{floor}(\text{age in completed months} / 12) -->
<!-- \end{equation} -->


<!-- | Relationship between dates | Age in completed years | -->
<!-- |:---------------------------|:-----------------------| -->
<!-- | $\text{month of event} > \text{month of birth}$ | $\text{year of event} - \text{year of birth}$ | -->
<!-- | $\text{month of event} = \text{month of birth}$, $\text{day of event} \ge \text{day of birth}$ | $\text{year of event} - \text{year of birth}$ | -->
<!-- | $\text{month of event} = \text{month of birth}$, $\text{day of event} \lt \text{day of birth}$ | $\text{year of event} - \text{year of birth} - 1$ | -->
<!-- | $\text{month of event} < \text{month of birth}$ | $\text{year of event} - \text{year of birth} - 1$ | -->



<!-- ## Single-year age groups -->

<!-- ```{r} -->
<!-- dth_age_yr <- deaths -->
<!-- dth_age_yr$age_10 <- date_to_age_year(date = dth_age_yr$date, -->
<!--                                    dob = dth_age_yr$dob, -->
<!--                                    break_max = 10) -->
<!-- dth_age_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_age_year(date = dth_age_yr$date, -->
<!--                       dob = dth_age_yr$dob, -->
<!--                       break_max = 10) -->
<!-- ``` -->

<!-- Change `break_max` -->

<!-- ```{r} -->
<!-- dth_age_yr$age_6 <- date_to_age_year(date = dth_age_yr$date, -->
<!--                                      dob = dth_age_yr$dob, -->
<!--                                      break_max = 6) -->
<!-- dth_age_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_year(date = dth_age_yr$date, -->
<!--                       dob = dth_age_yr$dob, -->
<!--                       break_max = 6) -->
<!-- ``` -->


<!-- ## Multi-year ages, with equal lengths -->


<!-- ```{r} -->
<!-- dth_age_multi <- deaths -->
<!-- dth_age_multi$age <- date_to_age_multi(date = dth_age_multi$date, -->
<!--                                        dob = dth_age_multi$dob, -->
<!--                                        break_max = 10) -->
<!-- dth_age_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_multi(date = dth_age_multi$date, -->
<!--                        dob = dth_age_multi$dob, -->
<!--                        break_max = 10) -->
<!-- ``` -->



<!-- ## Multi-year ages, with varying lengths -->

<!-- ```{r} -->
<!-- dth_age_custom <- deaths -->
<!-- dth_age_custom$age <- date_to_age_custom(date = dth_age_custom$date, -->
<!--                                          dob = dth_age_custom$dob, -->
<!--                                          breaks = c(0, 2, 5, 8, 14), -->
<!--                                          open_last = FALSE) -->
<!-- dth_age_custom -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_custom(date = dth_age_custom$date, -->
<!--                         dob = dth_age_custom$dob, -->
<!--                         breaks = c(0, 2, 5, 8, 14), -->
<!--                         open_last = FALSE) -->
<!-- ``` -->




<!-- ## Lifetable age groups -->

<!-- ```{r} -->
<!-- dth_age_lifetab <- deaths -->
<!-- dth_age_lifetab$age <- date_to_age_lifetab(date = dth_age_lifetab$date, -->
<!--                                          dob = dth_age_lifetab$dob, -->
<!--                                          break_max = 10) -->
<!-- dth_age_lifetab -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_lifetab(date = dth_age_lifetab$date, -->
<!--                          dob = dth_age_lifetab$dob, -->
<!--                          break_max = 10) -->
<!-- ``` -->

<!-- ## Age of parents -->

<!-- ```{r} -->
<!-- bth_in_age <- births_in -->
<!-- bth_in_age$age <- date_to_age_births(date = bth_in_age$date, -->
<!--                                      dob = bth_in_age$dob) -->
<!-- bth_in_age -->
<!-- ``` -->


<!-- ```{r, fig.width = 5, fig.height = 6} -->
<!-- plot_date_to_age_births(date = bth_in_age$date, -->
<!--                         dob = bth_in_age$dob) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- bth_out_age <- births_out -->
<!-- bth_out_age$age <- date_to_age_births(date = bth_out_age$date, -->
<!--                                       dob = bth_out_age$dob, -->
<!--                                       break_min = 10, -->
<!--                                       break_max = 55) -->
<!-- bth_out_age -->
<!-- ``` -->


<!-- ```{r, fig.width = 8, fig.height = 6} -->
<!-- plot_date_to_age_births(date = bth_out_age$date, -->
<!--                         dob = bth_out_age$dob, -->
<!--                         break_min = 10, -->
<!--                         break_max = 55) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- bth_out_age$age_recoded <- date_to_age_births(date = bth_out_age$date, -->
<!--                                               dob = bth_out_age$dob, -->
<!--                                               recode_up = TRUE, -->
<!--                                               recode_down = TRUE) -->
<!-- bth_out_age -->
<!-- ``` -->


<!-- ```{r, fig.width = 8, fig.height = 6} -->
<!-- plot_date_to_age_births(date = bth_out_age$date, -->
<!--                         dob = bth_out_age$dob, -->
<!--                         recode_up = TRUE, -->
<!--                         recode_down = TRUE) -->
<!-- ``` -->



<!-- ## Month-length ages -->

<!-- ```{r} -->
<!-- dth_age_month <- deaths -->
<!-- dth_age_month$age <- date_to_age_month(date = dth_age_month$date, -->
<!--                                        dob = dth_age_month$dob) -->
<!-- dth_age_month -->
<!-- ``` -->


<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_month(date = dth_age_month$date[3], -->
<!--                        dob = dth_age_month$dob[3], -->
<!--                        break_max = 20) -->
<!-- ``` -->



<!-- ## Quarter-length ages -->

<!-- ```{r} -->
<!-- dth_age_quarter <- deaths -->
<!-- dth_age_quarter$age <- date_to_age_quarter(date = dth_age_quarter$date, -->
<!--                                            dob = dth_age_quarter$dob) -->
<!-- dth_age_quarter -->
<!-- ``` -->


<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_age_quarter(date = dth_age_quarter$date[3], -->
<!--                        dob = dth_age_quarter$dob[3], -->
<!--                        break_max = 4) -->
<!-- ``` -->

<!-- # Lexis triangles -->

<!-- - age and time use same length steps (subject to complications of months and years having different lengths, plus open age group) -->
<!-- - one month; one quarter; one year; $n$ years -->
<!-- - age and time not enough to identify cohort; also need Lexis triangle -->
<!-- - abstract:  -->
<!-- - event is in upper Lexis triangle -->

<!-- - An event occurring during period $t$ to a person in age group $a$ belongs to the lower Lexis triangle if the person attains age $a$ during, and to the upper Lexis triangle otherwise. (Covers youngest and oldest age groups.) -->


<!-- - If index of time equals index for age, then Lower; else Upper. -->

<!-- How to work out triangle: -->

<!-- 1. Use date now and dob to calculate age group now -->
<!-- 2. Use date now to identify date at start of period -->
<!-- 3. Use date at start of period and dob to calculate whether entered age group during period -->
<!-- 4. If so, lower; if not upper. -->

<!-- ## Single-year age-time steps -->


<!-- ```{r} -->
<!-- dth_tri_yr <- deaths -->
<!-- dth_tri_yr$tri_jan <- date_to_triangle_year(date = dth_age_yr$date, -->
<!--                                             dob = dth_age_yr$dob, -->
<!--                                             break_max = 10) -->
<!-- dth_tri_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_year(date = dth_tri_yr$date, -->
<!--                            dob = dth_tri_yr$dob, -->
<!--                            break_max = 10) -->
<!-- ``` -->

<!-- Change from 1 Jan to 1 Jul -->

<!-- ```{r} -->
<!-- dth_tri_yr$tri_jul <- date_to_triangle_year(date = dth_age_yr$date, -->
<!--                                             dob = dth_age_yr$dob, -->
<!--                                             month_start = "Jul", -->
<!--                                             break_max = 10) -->
<!-- dth_tri_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_year(date = dth_tri_yr$date, -->
<!--                            dob = dth_tri_yr$dob, -->
<!--                            month_start = "Jul", -->
<!--                            break_max = 10) -->
<!-- ``` -->

<!-- Change `break_max` -->

<!-- ```{r} -->
<!-- dth_tri_yr$tri_6 <- date_to_triangle_year(date = dth_age_yr$date, -->
<!--                                           dob = dth_age_yr$dob, -->
<!--                                           break_max = 6) -->
<!-- dth_tri_yr -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_triangle_year(date = dth_tri_yr$date, -->
<!--                            dob = dth_tri_yr$dob, -->
<!--                            break_max = 6) -->
<!-- ``` -->


<!-- ## Multi-year age-time steps -->


<!-- ```{r} -->
<!-- dth_tri_multi <- deaths -->
<!-- dth_tri_multi$tri_5 <- date_to_triangle_multi(date = dth_age_multi$date, -->
<!--                                               dob = dth_age_multi$dob, -->
<!--                                               break_max = 30) -->
<!-- dth_tri_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_multi(date = dth_tri_multi$date, -->
<!--                            dob = dth_tri_multi$dob, -->
<!--                            break_max = 30) -->
<!-- ``` -->


<!-- 10-year time step -->


<!-- ```{r} -->
<!-- dth_tri_multi$tri_10 <- date_to_triangle_multi(date = dth_age_multi$date, -->
<!--                                                dob = dth_age_multi$dob, -->
<!--                                                width = 10, -->
<!--                                                break_max = 30) -->
<!-- dth_tri_multi -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_multi(date = dth_tri_multi$date, -->
<!--                             dob = dth_tri_multi$dob, -->
<!--                             width = 10, -->
<!--                             break_max = 30) -->
<!-- ``` -->




<!-- ## Births -->


<!-- ```{r} -->
<!-- births_in_tri <- births_in -->
<!-- births_in_tri$tri <- date_to_triangle_births(date = births_in_tri$date, -->
<!--                                              dob = births_in_tri$dob) -->
<!-- births_in_tri -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_births(date = births_in_tri$date, -->
<!--                              dob = births_in_tri$dob) -->
<!-- ``` -->




<!-- ## Quarter-length age-time steps -->


<!-- ```{r} -->
<!-- dth_tri_qu <- deaths -->
<!-- dth_tri_qu$tri <- date_to_triangle_quarter(date = dth_tri_qu$date, -->
<!--                                            dob = dth_tri_qu$dob, -->
<!--                                            break_max = 24) -->
<!-- dth_tri_qu -->
<!-- ``` -->

<!-- ```{r, echo = FALSE, fig.height = 6.5} -->
<!-- plot_date_to_triangle_quarter(date = dth_tri_qu$date, -->
<!--                               dob = dth_tri_qu$dob, -->
<!--                               break_max = 24) -->
<!-- ``` -->



<!-- ## Month-length age-time steps -->

<!-- ```{r} -->
<!-- dth_tri_month <- deaths -->
<!-- dth_tri_month$tri <- date_to_triangle_month(date = dth_tri_month$date, -->
<!--                                             dob = dth_tri_month$dob) -->
<!-- dth_tri_month -->
<!-- ``` -->


<!-- ```{r, echo = FALSE, fig.height = 6} -->
<!-- plot_date_to_triangle_month(date = dth_tri_month$date[3], -->
<!--                             dob = dth_tri_month$dob[3], -->
<!--                             break_max = 20) -->
<!-- ``` -->



<!-- # Plotting functions -->






